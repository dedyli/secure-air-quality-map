async function fetchTopPollutedCities() {
    const container = document.getElementById('top-cities-list');
    container.innerHTML = '<div class="loader">Loading live city data...</div>';
    try {
        // Use the correct '/latest' endpoint with 'parameter' in the query string
        const resp = await fetch(
            `${backendProxyUrl}/latest?limit=1000&parameter=pm25&order_by=lastUpdated`
        );
        if (!resp.ok) throw new Error(`API Error (${resp.status})`);

        const data = await resp.json();
        const results = data.results || [];
        console.log('Fetched records:', results.length, results.length > 0 ? results[0] : 'No results');

        // ... (the rest of your excellent processing logic) ...

        const cityMax = results.reduce((acc, rec) => {
            const city = rec.city || rec.location;
            if (city && rec.measurements && rec.measurements.length > 0) {
                acc[city] = Math.max(acc[city] || 0, rec.measurements[0].value);
            }
            return acc;
        }, {});

        const top5 = Object.entries(cityMax)
            .map(([city, pm25]) => ({ city, pm25 }))
            .sort((a, b) => b.pm25 - a.pm25)
            .slice(0, 5);

        container.innerHTML = '';
        top5.forEach((item, idx) => {
            const listItem = document.createElement('div');
            listItem.className = 'list-item';
            listItem.innerHTML =
                `<span class="city-name">${idx + 1}. ${item.city}</span>` +
                `<span class="aqi-value ${getAqiColorClass(item.pm25)}">${item.pm25.toFixed(1)} µg/m³</span>`;
            container.appendChild(listItem);
        });

    } catch (error) {
        console.error('Error loading top 5 cities:', error, error.stack);
        container.innerHTML = `<div class="error-message">Could not load city data.</div>`;
    }
}